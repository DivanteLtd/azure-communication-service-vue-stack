import{p as t,a,o as e,c as n,w as o,v as l,b as c,d as i,e as s,t as r,r as u,f as g,i as d,g as m,C as p,A as h,L as C,R as f,h as v}from"./vendor.da4a2f86.js";!function(t=".",a="__import__"){try{self[a]=new Function("u","return import(u)")}catch(e){const n=new URL(t,location),o=t=>{URL.revokeObjectURL(t.src),t.remove()};self[a]=t=>new Promise(((e,l)=>{const c=new URL(t,n);if(self[a].moduleMap[c])return e(self[a].moduleMap[c]);const i=new Blob([`import * as m from '${c}';`,`${a}.moduleMap['${c}']=m;`],{type:"text/javascript"}),s=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(i),onerror(){l(new Error(`Failed to import: ${t}`)),o(s)},onload(){e(self[a].moduleMap[c]),o(s)}});document.head.appendChild(s)})),self[a].moduleMap={}}}("/assets/");const w={name:"OutgoingCall",computed:{outgoing:{get:function(){return this.$store.getters.getOutgoing}},userToCall:{get(){return this.$store.state.outgoing.userToCall},set(t){this.$store.commit("userToCall",t)}}},methods:{startCall(){this.$store.dispatch("startCall")},hangUp(){this.$store.dispatch("hangUp")}}},y=i("data-v-6ca546ef");t("data-v-6ca546ef");const U=s("   ");a();const I=y(((t,a,i,s,r,u)=>(e(),n("div",null,[o(c("input",{id:"callee-id-input",type:"text",placeholder:"Who would you like to call?",style:{"margin-bottom":"1em",width:"200px"},"onUpdate:modelValue":a[1]||(a[1]=t=>u.userToCall=t)},null,512),[[l,u.userToCall]]),c("div",null,[c("button",{id:"call-button",type:"button",disabled:!u.outgoing.canCall,onClick:a[2]||(a[2]=(...t)=>u.startCall&&u.startCall(...t))}," Start Call ",8,["disabled"]),U,c("button",{id:"hang-up-button",type:"button",disabled:!u.outgoing.canHangUp,onClick:a[3]||(a[3]=(...t)=>u.hangUp&&u.hangUp(...t))}," Hang Up ",8,["disabled"])])]))));w.render=I,w.__scopeId="data-v-6ca546ef";const b={computed:{callerId:{get:function(){return this.$store.state.incoming.callerId}}},methods:{accept(){this.$store.dispatch("acceptCall")},decline(){this.$store.dispatch("declineCall")}}},V=i("data-v-d5159268");t("data-v-d5159268");const _=s("   ");a();const $=V(((t,a,o,l,i,s)=>(e(),n("div",null,[c("h3",null,"Incoming Call from: "+r(s.callerId),1),c("button",{id:"call-button",type:"button",onClick:a[1]||(a[1]=(...t)=>s.accept&&s.accept(...t))}," Accept "),_,c("button",{id:"hang-up-button",type:"button",onClick:a[2]||(a[2]=(...t)=>s.decline&&s.decline(...t))}," Decline ")]))));b.render=$,b.__scopeId="data-v-d5159268";const A={name:"Video"},O=i("data-v-73f4c24a");t("data-v-73f4c24a");const S={id:"video"};a();const M=O(((t,a,o,l,c,i)=>(e(),n("div",S))));A.render=M,A.__scopeId="data-v-73f4c24a";const D={components:{OutgoingCall:w,IncomingCall:b,Video:A},created(){this.$store.dispatch("getAuthData")},computed:{auth:{get:function(){return this.$store.getters.getAuthData}},showVideo:{get:function(){return this.$store.state.call.showVideo}},showOutgoing:{get:function(){return this.$store.state.call.outgoing}},showIncoming:{get:function(){return this.$store.state.call.incoming}}}},L=i("data-v-ef78ac18");t("data-v-ef78ac18");const T=c("h1",null,"Vue + Azure Communication Services",-1),H={id:"video"};a();const P=L(((t,a,l,i,s,d)=>{const m=u("Video"),p=u("OutgoingCall"),h=u("IncomingCall");return e(),n("div",null,[T,c("h3",null,"Your user ID: "+r(d.auth.user_id),1),o(c("div",H,[c(m)],512),[[g,d.showVideo]]),o(c("div",null,[c(p)],512),[[g,d.showOutgoing]]),o(c("div",null,[c(h)],512),[[g,d.showIncoming]])])}));D.render=P,D.__scopeId="data-v-ef78ac18";const k={components:{CommunicationService:D}},E=c("img",{alt:"Vue logo",src:"/assets/logo.03d6d6da.png"},null,-1);k.render=function(t,a,o,l,i,s){const r=u("CommunicationService");return e(),n("div",null,[E,c(r)])};const R=new d.Store({state:{auth:{},callAgent:{},deviceManager:{},outgoing:{userToCall:"",canCall:!1,canHangUp:!1},incoming:{callerId:"",canAccept:!0,canDecline:!1},call:{current:{},incoming:!1,outgoing:!0,showVideo:!1,inProgress:!1}},getters:{getAuthData:t=>t.auth,getOutgoing:t=>t.outgoing},mutations:{setAuthData:async function(t,a){let e;t.auth=a,await m.post("http://localhost:8000/get_access_token",t.auth.encrypted_auth).then((t=>{e=t.data}));const n=new p,o=new h(e);t.callAgent=await n.createCallAgent(o),t.callAgent.on("incomingCall",(async function({incomingCall:a}){t.call.incoming=!0,t.call.outgoing=!1,t.incoming.callerId=a._callerIdentity.communicationUserId,t.call.current=a})),t.deviceManager=await n.getDeviceManager(),t.outgoing.canCall=!0},userToCall:function(t,a){t.outgoing.userToCall=a}},actions:{getAuthData:async function({commit:t}){localStorage.getItem("auth-data-l")||await m.get("http://localhost:8000/issue_access_token").then((t=>{localStorage.setItem("auth-data-l",JSON.stringify(t.data))})),t("setAuthData",JSON.parse(localStorage.getItem("auth-data-l")))},startCall:function({commit:t,state:a,dispatch:e}){const n=a.deviceManager.getCameraList()[0],o={videoOptions:{localVideoStreams:[new C(n)]}};a.call.current=a.callAgent.call([{communicationUserId:a.outgoing.userToCall}],o),a.call.current.on("callEnded",(async function(t){a.call.outgoing=!0,a.call.incoming=!1,a.call.showVideo=!1,a.outgoing.canCall=!0,a.outgoing.canHangUp=!1,a.call.inProgress=!0})),a.call.outgoing=!0,a.outgoing.canCall=!1,a.outgoing.canHangUp=!0,e("showVideo")},hangUp:function({commit:t,state:a}){a.call.current.hangUp({forEveryone:!0}),a.outgoing.canCall=!0,a.outgoing.canHangUp=!1,a.call.showVideo=!1,a.call.inProgress=!1;document.getElementById("video").innerHTML=""},acceptCall:async function({commit:t,state:a,dispatch:e}){const n=a.deviceManager.getCameraList()[0],o={videoOptions:{localVideoStreams:[new C(n)]}};a.call.current=await a.call.current.accept(o),a.call.current.on("callEnded",(async function(t){a.call.outgoing=!0,a.call.incoming=!1,a.call.showVideo=!1,a.outgoing.canCall=!0,a.outgoing.canHangUp=!1,a.call.inProgress=!0})),e("showVideo")},declineCall:function({commit:t,state:a}){a.call.inProgress?(a.call.inProgress=!1,a.call.current.hangUp({forEveryone:!0})):a.call.current.reject(),a.call.outgoing=!0,a.call.incoming=!1,a.call.showVideo=!1,a.outgoing.canCall=!0,a.outgoing.canHangUp=!1},showVideo:async function({commit:t,state:a}){a.call.inProgress=!0,a.call.showVideo=!0;const e=a.call.current.remoteParticipants[0].videoStreams[0],n=new f(e),o=await n.createView();document.getElementById("video").appendChild(o.target)}}});v(k).use(R).mount("#app");
